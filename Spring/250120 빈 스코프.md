# 빈 스코프(Bean Scope)

- 스프링 컨테이너에서 빈이 생성되고 유지되는 범위와 생명주기를 정의하는 방법
- 빈이 존재할 수 있는 범위.

## **빈 스코프의 종류**

스프링에서는 아래와 같은 주요 빈 스코프를 제공함.

| 스코프 | 설명 | 주요 사용 컨텍스트 |
| --- | --- | --- |
| `singleton` | 스프링 컨테이너 내에서 빈이 단 하나만 생성되고 공유됨 | 기본 스코프, 대부분의 빈이 사용 |
| `prototype` | 요청할 때마다 새로운 빈 인스턴스가 생성됨 | 상태를 가지는 빈이나, 매번 새 객체가 필요할 때 |
| `request` | HTTP 요청 하나당 하나의 빈 인스턴스가 생성되고 요청이 끝나면 소멸됨 | 웹 애플리케이션 (Spring MVC) |
| `session` | HTTP 세션 동안 하나의 빈 인스턴스가 생성되고 세션이 끝나면 소멸됨 | 웹 애플리케이션 (Spring MVC) |
| `application` | 서블릿 컨텍스트 범위 동안 하나의 빈 인스턴스가 생성되고 공유됨 | 웹 애플리케이션에서 컨텍스트 전역으로 사용 |
| `websocket` | WebSocket 세션 동안 하나의 빈 인스턴스가 생성되고 세션 종료 시 소멸됨 | 실시간 통신(WebSocket) 관련 애플리케이션 |

## **빈 스코프별 특징**

- 싱글톤, 프로토타입, 웹스코프까지 가장 많이 쓰임.

### 1. **Singleton 스코프** (기본 스코프)

- 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프.
- 컨테이너에서 빈이 하나만 생성되고 모든 요청에서 동일한 인스턴스를 공유
- 웹환경 스코프는 거의 실무에서 쓰지 않음.
- 주로 상태를 가지지 않는(Stateless) 객체에 적합
- **사용 예**: 서비스 클래스, DAO 클래스 등.

### 2. **Prototype 스코프**

- 빈을 요청할 때마다 새로운 인스턴스를 생성
- 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프
- 종료 메소드가 따로 호출되지 않기 때문에 빈을 조회한 클라이언트가 관리해야 함 → 종료 메서드에 대한 호출도 클라이언트가 직접해야 함.
- **사용 예**: 상태를 가지는(Stateful) 객체, 매번 새로운 인스턴스가 필요한 경우.
- 실무에서 웹 애플리케이션을 개발해보면, 싱글톤 빈으로 대부분의 문제를 해결할 수 있기 때문에 프로토타입 빈을 직접적으로 사용하는 일은 매우 드뭄.

### 싱글톤 빈과 프로토타입 스코프를 함께 사용할 때 문제점

- 스프링은 일반적으로 싱글톤 빈을 사용하기 때문에 프로토타입 일지라도 프로토타입 빈도 이 시점에 한 번만 생성되어 싱글톤 빈에 주입됨 그 이후에 빈이 사용될 때는 이미 생성된 프로토타입 빈 인스턴스를 재사용하게 됨.

### 해결방법

- 의존관계를 외부에서 주입(DI) 받는게 아니라 이렇게 직접 필요한 의존관계를 찾는 것을 Dependency Lookup (DL) 의존관계 조회(탐색)하면 됨
- 프로토타입 빈의 요청을 **필요할 때마다 처리**하도록 지연 처리.
    
    → JSR-330 Provider (자바 에서 제공) 사용
    
    →  ObjectFactory, ObjectProvider (스프링에서 제공)을 통해 
    
    - ObjectFactory: 기능이 단순, 별도의 라이브러리 필요 없음, 스프링에 의존
    - ObjectProvider: ObjectFactory 상속, 옵션, 스트림 처리등 편의 기능이 많고, 별도의 라이브러리 필요 없음, 스프링에 의존

### 3. **Request 스코프** (웹 환경)

- 웹 요청이 들어오고 나갈때 까지 유지되는 스코프
- Spring MVC 컨트롤러, 필터 등에서 사용됨
- **사용 예**: 요청 단위로 데이터를 유지해야 하는 경우(예: Request Context).

### 4. **Session 스코프** (웹 환경)

- 웹 세션이 생성되고 종료될 때 까지 유지되는 스코프
- **사용 예**: 사용자 세션 정보를 저장하는 경우.

### 5. **Application 스코프** (웹 환경)

- ServletContext와 동일한 생명주기를 가지는 스코프.
- 애플리케이션 전체에서 공유애플리케이션 시작 시 생성되고 종료 시 소멸됩니다.
- **사용 예**: 전역적으로 공유해야 하는 빈.

### 6. **WebSocket 스코프** (웹 환경)

- **설명**: WebSocket 세션 단위로 빈이 생성
- WebSocket 세션 동안 유효합니, WebSocket 연결이 종료되면 빈도 소멸됩니다.
- **사용 예**: 실시간 채팅이나 데이터 스트리밍 서비스.