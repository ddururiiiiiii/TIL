# **트리거 (Trigger)**

- 데이터베이스에서 특정 이벤트(INSERT, UPDATE, DELETE)가 발생했을 때 **자동으로 실행되는 저장된 프로시저**
- 트리거는 **데이터의 무결성을 유지**하고, **자동화된 작업**을 수행하는 데 유용
- **ex. 계좌 이체**: 이체 시, 로그 테이블에 기록하는 트리거.
    
    ```sql
    CREATE TRIGGER log_transfer
    AFTER INSERT ON transfers
    FOR EACH ROW
    BEGIN
        INSERT INTO transfer_logs (transfer_id, created_at)
        VALUES (NEW.id, NOW());
    END;
    ```
    

### **트리거의 주요 특징**

1. **자동 실행**: 데이터베이스 테이블에서 지정된 이벤트가 발생하면 트리거가 자동으로 실행
2. **이벤트 기반**: `INSERT`, `UPDATE`, `DELETE`와 같은 작업이 트리거를 활성화
3. **테이블과 연결**: 특정 테이블에 설정되며, 해당 테이블에서만 작동

### **트리거의 주요 사용 목적**

1. **데이터 무결성 유지**:
    - 트리거를 사용하여 데이터의 정합성을 자동으로 보장.
    - 예: 주문 수량이 음수가 되지 않도록 강제.
2. **로그 기록**:
    - 데이터를 수정하거나 삭제할 때 변경 내용을 자동으로 기록.
    - 예: 직원 정보 변경 시, 변경 기록을 `audit_logs` 테이블에 저장.
3. **비즈니스 로직 자동화**:
    - 특정 이벤트가 발생할 때 자동으로 비즈니스 로직 수행.
    - 예: 고객 계좌 잔액이 0 이하로 떨어지면 알림 발송.

---

### **트리거의 유형**

### **1) 실행 시점에 따른 분류**

| **종류** | **설명** |
| --- | --- |
| **BEFORE** | 이벤트가 발생하기 전에 실행. 주로 데이터 검증에 사용. |
| **AFTER** | 이벤트가 발생한 후에 실행. 로그 기록이나 후속 작업에 사용. |
| **INSTEAD OF** | 기본 동작을 대체. 주로 뷰(View)와 함께 사용되며, 뷰에서 직접 데이터를 수정하는 작업을 지원. |

---

### **2) 이벤트에 따른 분류**

| **이벤트** | **설명** |
| --- | --- |
| **INSERT** | 데이터가 삽입될 때 실행. |
| **UPDATE** | 데이터가 수정될 때 실행. |
| **DELETE** | 데이터가 삭제될 때 실행. |

---

### **트리거의 장점**

1. **자동화**: 수동으로 처리해야 할 작업을 자동으로 수행.
2. **데이터 무결성 보장**: 비즈니스 규칙을 강제하거나 잘못된 데이터를 방지.
3. **감사 및 추적**: 데이터 변경 이력을 자동으로 기록.
4. **중앙 집중 관리**: 트리거는 데이터베이스 레벨에서 동작하므로 애플리케이션 변경 없이도 작업 수행 가능.

### **트리거의 단점**

1. **복잡성 증가**: 트리거가 많아지면 시스템 동작을 이해하기 어려워질 수 있음.
2. **성능 저하:** 잡한 트리거는 추가 작업을 수행하므로 쿼리 실행 속도를 느리게 할 수 있음.
3. **디버깅 어려움**: 트리거에서 발생한 문제를 추적하기 어려움.
4. **의도치 않은 실행**: 특정 이벤트에서 트리거가 의도치 않게 활성화될 가능성.

### **트리거의 현실적인 사용 사례**

### 1) **쇼핑몰 주문 관리**

- 주문 테이블에서 `AFTER INSERT` 트리거를 사용해:
    - 고객 이메일로 주문 확인 이메일 발송.
    - 주문 데이터 기록 테이블에 저장.

### 2) **은행 시스템**

- 계좌 이체 시, 이체 내역을 `transactions` 테이블에 자동으로 기록.

### 3) **로그 관리**

- 직원 정보 수정이나 삭제 시, `audit_logs` 테이블에 자동으로 변경 내용 기록.

### **트리거와 저장 프로시저의 차이**

| **특징** | **트리거(Trigger)** | **저장 프로시저(Stored Procedure)** |
| --- | --- | --- |
| **실행 시점** | 특정 이벤트 발생 시 자동 실행 | 호출 시점에 사용자가 직접 호출 |
| **용도** | 이벤트 기반 자동 작업 | 복잡한 작업이나 반복 작업 수행 |
| **주요 사용 예** | 데이터 변경 시 검증, 로그 기록 | 대량 데이터 처리, 계산 작업 |

### **트리거 사용 시 주의점**

1. **성능 테스트**: 트리거가 시스템 성능에 미치는 영향을 주기적으로 분석.
2. **필요한 경우에만 사용**: 비즈니스 로직을 애플리케이션 코드로 처리할 수 있다면 트리거 사용을 최소화.
3. **루프 방지**: 트리거가 다른 트리거를 활성화하여 무한 루프를 발생시키지 않도록 주의.
4. **의존성 관리**: 트리거가 특정 테이블과 강하게 연결되므로 테이블 구조 변경 시 트리거도 함께 관리 필요.

(+) (데이터베이스 질문 빈도 낮음)